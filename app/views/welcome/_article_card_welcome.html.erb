<br><br><br><br>
<% @users.each do |user| %>
  <% user.articles.last(1).each do |article| %>

  <%= image_tag user.avatar.url(:small) %>
  <p style="display: inline; margin-left: 1.5em;"><%= link_to user.username, profiles_path(user.id), id:"user-link" %></p>

    <div class="card" id="article-card">
        <div class="card-content">
        <span style="opacity: 0.2; margin-left: 1.5em; letter-spacing: 1px;"><%= article.created_at.strftime("%d %b %Y") %></span>
        <div style="float: right;">

        <% if user_signed_in? %>
          <!--Vote button -->
            <%= link_to '', users_vote_path(article_id: article.id), remote: true, class: "fa fa-chevron-up", id:"glyphicons", method: :post %>
        <% else %>
            <i class="fa fa-chevron-up" aria-hidden="true"></i>
        <% end %>
          <!-- Votes counter -->
            <span id="votes-article-<%=article.id%>"><%= article.votes.count %></span>


            <br>
            <% if user_signed_in? %> <!-- Deleting an article -->
              <% if current_user.id == article.user_id %>
                <%= link_to '',  article,class: "fa fa-trash-o",id:"glyphicons", method: :delete, data: { confirm: 'Are you sure?' } %>
                <br>
              <% end %>
            <% end %>
            </div>

          <h2><%=  article.title %></h2>
          <br>
          <p class="more" style="text-align: justify; text-justify: inter-word; opacity: 0.5; letter-spacing: 1px; width: 85%; margin-left: auto; margin-right: auto;"><%=  article.description %></p>
        </div>
        <p id="border"/>

<!-- Comments icon -->
<i class="fa fa-comments fa-3x" aria-hidden="true" style="opacity:0.1; margin-right: auto; margin-left: auto; margin-top: 20px;"></i>
<% if article.comments.count == 0 %> <!-- If there are no comments - show message -->
  <p style="opacity:0.3;">No comments yet.</p>
  <br>
<% end %>
<br><br>
<% unless article.comments.empty? %>
  <button id="show-comments-btn" class="waves-effect waves-light btn"> Show Comments (<%= article.comments.count %>)</button>
  <button id="hide-comments-btn" class="waves-effect waves-light btn"> Hide Comments </button>
<% end %>
      <!-- Comments -->
      <div id="comments">
              <% article.comments.each do |comment| %>

              <p id="comment-username">
               <%= link_to comment.user.username, profiles_path(comment.user_id), id:"comment-user-link" %>
              </p>
              <p id="comment-created-at">
                <%= comment.created_at.strftime("%d %b %Y") %>
              </p>
              <p id="comment-content" style="text-align: justify; text-justify: inter-word;">
                <%= comment.description %>
               </p>

            <!-- Deleting comment -->
            <% if user_signed_in?%>
                  <% if comment.user_id == current_user.id%>
                      <%= link_to '', [article, comment], remote:true, method: :delete, data: { confirm: 'Are you sure?' }, id:"delete-comment", class: "fa fa-trash-o"%> 
                  <% end %>
            <% end %>

                <br>
                <p id="border"/>
              <% end %>
      </div>


<% if user_signed_in? %> <!-- Comment form -->
  <div style="margin-left: auto; margin-right: auto; width:50%;">
      <%= form_for [article, @comment] do |f| %> 
      <br>
        <div class="input-field col s6">
             <label for="comment-text-field">Comment</label>
             <%= f.text_field :description, :class => "materialize-textarea", :length => "240", :id => "comment-text-field" %>
         </div>
      <% end %>
     </div>
<% end %>

    </div>
    <div class="mdl-card__menu" id="article-<%= article.id %>">
      

      <script type="text/javascript">
      //SHOW COMMENT BTN
          $('#comments').hide();
          $('#hide-comments-btn').hide();
          $('#show-comments-btn').on('click', function() {
             $('#comments').show();
             $('#hide-comments-btn').show();
             $(this).hide();
          })
          $('#hide-comments-btn').on('click', function() {
            $('#comments').hide();
            $('#show-comments-btn').show();
            $('#hide-comments-btn').hide();
          });


      </script>


        </div>
  </div>
  </div>
  </div>
   <br><br>
    <% end %>
  <% end %>